# RAG çŸ¥è¯†åº“ç³»ç»Ÿ - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### å‰ç½®è¦æ±‚

- Node.js >= 16
- Docker & Docker Compose
- OpenAI API å¯†é’¥ï¼ˆè·å–ï¼šhttps://platform.openai.com/api-keysï¼‰

### æ­¥éª¤ 1: å…‹éš†å¹¶å®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd GraduationProject

# å®‰è£…åç«¯ä¾èµ–
cd backend
npm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd ../frontend
npm install
```

### æ­¥éª¤ 2: å¯åŠ¨åŸºç¡€æœåŠ¡

```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# å¯åŠ¨ PostgreSQL å’Œ Milvus
docker-compose up -d

# éªŒè¯æœåŠ¡å¯åŠ¨
docker-compose ps
```

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶åç«¯ç¯å¢ƒé…ç½®
cd backend
cp .env.example .env

# ç¼–è¾‘ .envï¼Œæ·»åŠ  OpenAI API å¯†é’¥
# ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€ .env
# OPENAI_API_KEY=sk-your-api-key-here
```

### æ­¥éª¤ 4: å¯åŠ¨åº”ç”¨

```bash
# ç»ˆç«¯ 1: å¯åŠ¨åç«¯
cd backend
npm run start:dev

# ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯
cd frontend
npm run dev
```

### æ­¥éª¤ 5: è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5173

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. æ·»åŠ æ–‡æ¡£åˆ°çŸ¥è¯†åº“

```bash
curl -X POST http://localhost:3001/api/knowledge-base/documents \
  -H "Content-Type: application/json" \
  -d '{
    "title": "JavaScript å¼‚æ­¥ç¼–ç¨‹æŒ‡å—",
    "content": "JavaScript ä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚ä¸»è¦åŒ…æ‹¬ Callbackã€Promiseã€Async/Await ä¸‰ç§æ–¹å¼...",
    "source": "https://example.com/js-async"
  }'
```

### 2. æŸ¥è¯¢çŸ¥è¯†åº“

```bash
curl -X POST http://localhost:3001/api/knowledge-base/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "JavaScript ä¸­å¦‚ä½•å¤„ç†å¼‚æ­¥æ“ä½œï¼Ÿ",
    "topK": 5,
    "threshold": 0.5
  }'
```

### 3. RAG æŸ¥è¯¢ï¼ˆè·å–å¢å¼ºæç¤ºè¯ï¼‰

```bash
curl -X POST http://localhost:3001/api/knowledge-base/rag-query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "å¦‚ä½•ä½¿ç”¨ Promiseï¼Ÿ",
    "topK": 3
  }'
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    React å‰ç«¯åº”ç”¨               â”‚
â”‚    (Vite + TypeScript)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NestJS åç«¯æœåŠ¡              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ KnowledgeBaseController     â”‚â”‚
â”‚  â”‚ - æ–‡æ¡£ç®¡ç† API              â”‚â”‚
â”‚  â”‚ - æŸ¥è¯¢ API                  â”‚â”‚
â”‚  â”‚ - RAG æŸ¥è¯¢ API              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚
         â–¼                  â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PostgreSQL  â”‚   â”‚ LangChain    â”‚
  â”‚ (æ–‡æ¡£å­˜å‚¨)  â”‚   â”‚ (å¤„ç†/å‘é‡)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  OpenAI API      â”‚
                   â”‚  (Embeddings)    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Milvus å‘é‡DB  â”‚
      â”‚  (å‘é‡æœç´¢)     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ æ ¸å¿ƒåŠŸèƒ½

### 1. æ–‡æ¡£ç®¡ç†
- âœ… æ·»åŠ æ–‡æ¡£
- âœ… æ›´æ–°æ–‡æ¡£
- âœ… åˆ é™¤æ–‡æ¡£
- âœ… åˆ—å‡ºæ–‡æ¡£

### 2. æ™ºèƒ½æœç´¢
- âœ… è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢
- âœ… å‘é‡åŒ–å¤„ç†
- âœ… è‡ªåŠ¨æ–‡æœ¬åˆ†å‰²

### 3. RAG åŠŸèƒ½
- âœ… æ£€ç´¢å¢å¼ºç”Ÿæˆ
- âœ… ä¸Šä¸‹æ–‡æ„ŸçŸ¥æŸ¥è¯¢
- âœ… æç¤ºè¯è‡ªåŠ¨æ„å»º

## ğŸ“Š API æ–‡æ¡£

### æ·»åŠ æ–‡æ¡£
```
POST /api/knowledge-base/documents
Content-Type: application/json

{
  "title": "æ–‡æ¡£æ ‡é¢˜",
  "content": "æ–‡æ¡£å†…å®¹",
  "source": "æ–‡æ¡£æ¥æºï¼ˆå¯é€‰ï¼‰",
  "metadata": {}
}
```

### æŸ¥è¯¢çŸ¥è¯†åº“
```
POST /api/knowledge-base/query
Content-Type: application/json

{
  "query": "æŸ¥è¯¢å†…å®¹",
  "topK": 5,
  "threshold": 0.5
}
```

### è·å–ç»Ÿè®¡ä¿¡æ¯
```
GET /api/knowledge-base/statistics
```

### è·å–æ–‡æ¡£åˆ—è¡¨
```
GET /api/knowledge-base/documents
```

### åˆ é™¤æ–‡æ¡£
```
DELETE /api/knowledge-base/documents/{documentId}
```

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šMilvus è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ Milvus çŠ¶æ€
docker-compose logs milvus

# é‡å¯ Milvus
docker-compose restart milvus
```

### é—®é¢˜ï¼šOpenAI API é”™è¯¯
```bash
# æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®
echo $OPENAI_API_KEY

# ç¡®ä¿ API å¯†é’¥æœ‰æ•ˆä¸”æœ‰é…é¢
```

### é—®é¢˜ï¼šæ–‡æ¡£å¤„ç†å¤±è´¥
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs backend

# æ£€æŸ¥æ–‡æ¡£å¤§å°æ˜¯å¦è¿‡å¤§
```

## ğŸ“š ç¤ºä¾‹æ•°æ®

### ç¤ºä¾‹ 1: æ·»åŠ  Python æ•™ç¨‹

```bash
curl -X POST http://localhost:3001/api/knowledge-base/documents \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Python å‡½æ•°ç¼–ç¨‹",
    "content": "Python ä¸­çš„å‡½æ•°æ˜¯å¯é‡ç”¨çš„ä»£ç å—ã€‚ä½¿ç”¨ def å…³é”®å­—å®šä¹‰å‡½æ•°ã€‚å‡½æ•°å¯ä»¥æ¥å—å‚æ•°å¹¶è¿”å›å€¼ã€‚è£…é¥°å™¨æ˜¯ Python ä¸­çš„é«˜çº§ç‰¹æ€§ï¼Œå…è®¸ä¿®æ”¹å‡½æ•°çš„è¡Œä¸ºã€‚",
    "source": "python-tutorial"
  }'
```

### ç¤ºä¾‹ 2: æŸ¥è¯¢ Python çŸ¥è¯†

```bash
curl -X POST http://localhost:3001/api/knowledge-base/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Python ä¸­å¦‚ä½•å®šä¹‰å‡½æ•°ï¼Ÿ",
    "topK": 3,
    "threshold": 0.5
  }'
```

## ğŸ¯ å¸¸è§ç”¨ä¾‹

### ç”¨ä¾‹ 1: ä¸ªäººçŸ¥è¯†åº“
1. æ·»åŠ ä½ çš„å­¦ä¹ ç¬”è®°
2. ä½¿ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢
3. è·å–ç›¸å…³å†…å®¹
4. ä¸ LLM ç»“åˆç”Ÿæˆç­”æ¡ˆ

### ç”¨ä¾‹ 2: ä¼ä¸šæ–‡æ¡£æ£€ç´¢
1. å¯¼å…¥ä¼ä¸šæ–‡æ¡£
2. å‘˜å·¥å¿«é€Ÿæœç´¢
3. è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦
4. å‡å°‘æ–‡æ¡£æŸ¥æ‰¾æ—¶é—´

### ç”¨ä¾‹ 3: å®¢æœçŸ¥è¯†åº“
1. æ·»åŠ å¸¸è§é—®é¢˜å’Œç­”æ¡ˆ
2. è‡ªåŠ¨åŒ¹é…ç”¨æˆ·æŸ¥è¯¢
3. æä¾›ç›¸å…³ç­”æ¡ˆ
4. æŒç»­ä¼˜åŒ–

## ğŸš¦ æ€§èƒ½ä¼˜åŒ–

### 1. æ–‡æœ¬åˆ†å‰²ä¼˜åŒ–
```typescript
// åœ¨ langchain.service.ts ä¸­è°ƒæ•´
chunkSize: 1000,      // æ ¹æ®å†…å®¹ç±»å‹è°ƒæ•´
chunkOverlap: 200     // å¢åŠ é‡å ä»¥æé«˜ç›¸å…³æ€§
```

### 2. Milvus ç´¢å¼•ä¼˜åŒ–
```typescript
// åœ¨ milvus.service.ts ä¸­é€‰æ‹©åˆé€‚çš„ç´¢å¼•
index_type: 'HNSW',   // æ›´å¥½çš„æ€§èƒ½
metric_type: 'L2'     // æ¬§æ°è·ç¦»
```

### 3. æ‰¹é‡æ“ä½œ
```bash
# ä½¿ç”¨æ‰¹é‡ API å¤„ç†å¤šä¸ªæ–‡æ¡£
for doc in documents:
  POST /api/knowledge-base/documents
```

## ğŸ“– å­¦ä¹ èµ„æº

- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [Milvus å®˜æ–¹æ–‡æ¡£](https://milvus.io/docs)
- [OpenAI Embeddings](https://platform.openai.com/docs/guides/embeddings)
- [RAG è®ºæ–‡](https://arxiv.org/abs/2005.11401)

## ğŸ’¡ æç¤º

1. **API å¯†é’¥å®‰å…¨**: ä¸è¦å°† API å¯†é’¥æäº¤åˆ° Gitï¼Œä½¿ç”¨ .env æ–‡ä»¶
2. **å‘é‡ç»´åº¦**: OpenAI text-embedding-3-small ä½¿ç”¨ 1536 ç»´
3. **ç›¸ä¼¼åº¦é˜ˆå€¼**: 0.5-0.7 æ˜¯å¸¸è§çš„èŒƒå›´ï¼Œæ ¹æ®éœ€æ±‚è°ƒæ•´
4. **æ–‡æ¡£å¤§å°**: å»ºè®®å•ä¸ªæ–‡æ¡£ä¸è¶…è¿‡ 100KB
5. **æ‰¹é‡å¤„ç†**: ä½¿ç”¨æ‰¹é‡ API æé«˜æ•ˆç‡

## ğŸ› è°ƒè¯•

å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š
```bash
# åç«¯
DEBUG=* npm run start:dev

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
LOG_LEVEL=debug npm run start:dev
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ‰€æœ‰æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ (`docker-compose ps`)
2. API å¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–æ›´å¤šä¿¡æ¯

## ğŸ‰ ä¸‹ä¸€æ­¥

- æ¢ç´¢é«˜çº§ RAG åŠŸèƒ½
- é›†æˆä½ çš„ LLM æ¨¡å‹
- æ„å»ºè‡ªå®šä¹‰åº”ç”¨
- ä¼˜åŒ–æœç´¢æ€§èƒ½

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€