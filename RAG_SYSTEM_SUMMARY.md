# RAG çŸ¥è¯†åº“ç³»ç»Ÿ - å®Œæ•´å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

å·²æˆåŠŸä¸ºä½ çš„ AI é¢è¯•å®˜ç³»ç»Ÿé›†æˆäº†å®Œæ•´çš„ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çŸ¥è¯†åº“åŠŸèƒ½ã€‚è¯¥ç³»ç»Ÿç»“åˆäº† **LangChain**ã€**Milvus** å’Œ **OpenAI Embeddings**ï¼Œæä¾›å¼ºå¤§çš„æ–‡æ¡£ç®¡ç†å’Œæ™ºèƒ½æŸ¥è¯¢èƒ½åŠ›ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

âœ… **æ–‡æ¡£ç®¡ç†**
- æ·»åŠ ã€æ›´æ–°ã€åˆ é™¤æ–‡æ¡£
- è‡ªåŠ¨æ–‡æœ¬åˆ†å‰²å’Œå‘é‡åŒ–
- ç”¨æˆ·æ•°æ®éš”ç¦»

âœ… **æ™ºèƒ½æœç´¢**
- åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„å‘é‡æœç´¢
- è‡ªå®šä¹‰ç›¸ä¼¼åº¦é˜ˆå€¼
- è¿”å›ç›¸å…³æ–‡æ¡£æ’åºç»“æœ

âœ… **RAG å¢å¼º**
- è‡ªåŠ¨æ„å»ºå¢å¼ºæç¤ºè¯
- ä¸ LLM æ— ç¼é›†æˆ
- æ”¯æŒå¤šè½®å¯¹è¯

âœ… **é«˜çº§åŠŸèƒ½**
- æ–‡æ¡£æ€»ç»“
- å…³é”®è¯æå–
- æ–‡æ¡£åˆ†ç±»
- ç­”æ¡ˆè´¨é‡è¯„ä¼°
- é—®é¢˜ç”Ÿæˆ

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶åˆ—è¡¨

### åç«¯æ–‡ä»¶ç»“æ„

```
backend/src/knowledge-base/
â”œâ”€â”€ entities/
â”‚   â””â”€â”€ knowledge-document.entity.ts           # çŸ¥è¯†åº“æ–‡æ¡£å®ä½“
â”‚
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-document.dto.ts                 # åˆ›å»ºæ–‡æ¡£ DTO
â”‚   â””â”€â”€ query-knowledge.dto.ts                 # æŸ¥è¯¢ DTO
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ milvus.service.ts                      # Milvus å‘é‡æ•°æ®åº“æœåŠ¡
â”‚   â”‚   - é›†åˆåˆå§‹åŒ–
â”‚   â”‚   - å‘é‡æ’å…¥/åˆ é™¤
â”‚   â”‚   - ç›¸ä¼¼åº¦æœç´¢
â”‚   â”‚
â”‚   â”œâ”€â”€ langchain.service.ts                   # LangChain é›†æˆæœåŠ¡
â”‚   â”‚   - æ–‡æœ¬åˆ†å‰²
â”‚   â”‚   - å‘é‡ç”Ÿæˆ
â”‚   â”‚   - RAG æç¤ºæ„å»º
â”‚   â”‚
â”‚   â”œâ”€â”€ knowledge-base.service.ts              # çŸ¥è¯†åº“ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   - æ–‡æ¡£å¤„ç†æµç¨‹
â”‚   â”‚   - æŸ¥è¯¢ç®¡ç†
â”‚   â”‚   - ç»Ÿè®¡ä¿¡æ¯
â”‚   â”‚
â”‚   â”œâ”€â”€ llm-integration.service.ts             # LLM é›†æˆæœåŠ¡
â”‚   â”‚   - RAG ç­”æ¡ˆç”Ÿæˆ
â”‚   â”‚   - æ–‡æ¡£æ€»ç»“
â”‚   â”‚   - å…³é”®è¯æå–
â”‚   â”‚   - ç­”æ¡ˆè¯„ä¼°
â”‚   â”‚
â”‚   â””â”€â”€ knowledge-base.service.spec.ts         # å•å…ƒæµ‹è¯•
â”‚
â”œâ”€â”€ knowledge-base.controller.ts               # API æ§åˆ¶å™¨
â”‚   - POST /documents (æ·»åŠ æ–‡æ¡£)
â”‚   - GET /documents (è·å–åˆ—è¡¨)
â”‚   - POST /query (æŸ¥è¯¢)
â”‚   - POST /rag-query (RAG æŸ¥è¯¢)
â”‚   - PUT /documents/:id (æ›´æ–°)
â”‚   - DELETE /documents/:id (åˆ é™¤)
â”‚   - GET /statistics (ç»Ÿè®¡)
â”‚
â””â”€â”€ knowledge-base.module.ts                   # æ¨¡å—å®šä¹‰
```

### é…ç½®æ–‡ä»¶

```
backend/
â”œâ”€â”€ .env.example                               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json                               # å·²æ›´æ–°ä¾èµ–
â”œâ”€â”€ docker-compose.yml                         # æœåŠ¡ç¼–æ’é…ç½®
â””â”€â”€ RAG_KNOWLEDGE_BASE_README.md               # è¯¦ç»†æ–‡æ¡£

frontend/src/components/
â””â”€â”€ KnowledgeBase.tsx                          # å‰ç«¯ç»„ä»¶

root/
â”œâ”€â”€ QUICK_START_RAG.md                         # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â””â”€â”€ INTEGRATION_EXAMPLES.md                    # é›†æˆç¤ºä¾‹
```

## ğŸ“¦ æ–°å¢ä¾èµ–

```json
{
  "langchain": "^0.1.35",
  "@langchain/core": "^0.1.46",
  "@langchain/community": "^0.0.37",
  "@langchain/openai": "^0.0.33",
  "milvus2-sdk-node": "^2.4.3",
  "pdf-parse": "^1.1.1",
  "axios": "^1.6.5"
}
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å®‰è£…ä¾èµ–
```bash
cd backend && npm install
cd ../frontend && npm install
```

### 2. å¯åŠ¨æœåŠ¡
```bash
# ç»ˆç«¯ 1: å¯åŠ¨æ•°æ®åº“å’Œ Milvus
docker-compose up -d

# ç»ˆç«¯ 2: å¯åŠ¨åç«¯
cd backend && npm run start:dev

# ç»ˆç«¯ 3: å¯åŠ¨å‰ç«¯
cd frontend && npm run dev
```

### 3. é…ç½®ç¯å¢ƒ
```bash
cp backend/.env.example backend/.env
# ç¼–è¾‘ .envï¼Œæ·»åŠ  OPENAI_API_KEY
```

### 4. è®¿é—®åº”ç”¨
```
å‰ç«¯: http://localhost:5173
åç«¯: http://localhost:3001
```

## ğŸ”Œ API ç«¯ç‚¹

### æ–‡æ¡£ç®¡ç†

```bash
# æ·»åŠ æ–‡æ¡£
POST /api/knowledge-base/documents
{
  "title": "æ–‡æ¡£æ ‡é¢˜",
  "content": "æ–‡æ¡£å†…å®¹",
  "source": "æ¥æº",
  "metadata": {}
}

# è·å–æ–‡æ¡£åˆ—è¡¨
GET /api/knowledge-base/documents

# è·å–å•ä¸ªæ–‡æ¡£
GET /api/knowledge-base/documents/{id}

# æ›´æ–°æ–‡æ¡£
PUT /api/knowledge-base/documents/{id}

# åˆ é™¤æ–‡æ¡£
DELETE /api/knowledge-base/documents/{id}
```

### æŸ¥è¯¢åŠŸèƒ½

```bash
# åŸºç¡€æŸ¥è¯¢
POST /api/knowledge-base/query
{
  "query": "æŸ¥è¯¢å†…å®¹",
  "topK": 5,
  "threshold": 0.5
}

# RAG æŸ¥è¯¢
POST /api/knowledge-base/rag-query
{
  "query": "æŸ¥è¯¢å†…å®¹",
  "topK": 3,
  "threshold": 0.5
}

# è·å–ç»Ÿè®¡
GET /api/knowledge-base/statistics
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    React å‰ç«¯ (Vite)            â”‚
â”‚    - æ–‡æ¡£ç®¡ç†ç•Œé¢               â”‚
â”‚    - æŸ¥è¯¢ç•Œé¢                   â”‚
â”‚    - AI å¯¹è¯ç•Œé¢                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NestJS åç«¯                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ KnowledgeBaseController     â”‚â”‚
â”‚  â”‚ - æ–‡æ¡£ API                  â”‚â”‚
â”‚  â”‚ - æŸ¥è¯¢ API                  â”‚â”‚
â”‚  â”‚ - RAG API                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚
         â–¼                  â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PostgreSQL  â”‚   â”‚ LangChain    â”‚
  â”‚ (å…ƒæ•°æ®)    â”‚   â”‚ (å¤„ç†)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  OpenAI API      â”‚
                   â”‚  (Embeddings)    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Milvus å‘é‡DB  â”‚
      â”‚  (å‘é‡å­˜å‚¨)     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®æµ

### æ–‡æ¡£å¤„ç†æµç¨‹
```
åŸå§‹æ–‡æ¡£
  â†“
LangChain åˆ†å‰² (RecursiveCharacterTextSplitter)
  â†“
æ–‡æœ¬å— (chunkSize: 1000, overlap: 200)
  â†“
OpenAI Embeddings (text-embedding-3-small, 1536ç»´)
  â†“
å‘é‡æ•°æ®
  â†“
Milvus å­˜å‚¨ (IVF_FLAT ç´¢å¼•)
```

### æŸ¥è¯¢æµç¨‹
```
ç”¨æˆ·æŸ¥è¯¢
  â†“
ç”ŸæˆæŸ¥è¯¢å‘é‡ (OpenAI Embeddings)
  â†“
Milvus ç›¸ä¼¼åº¦æœç´¢ (L2 è·ç¦»)
  â†“
è¿”å›ç›¸å…³æ–‡æ¡£å— (æŒ‰ç›¸ä¼¼åº¦æ’åº)
  â†“
æ„å»º RAG æç¤ºè¯
  â†“
å‘é€ç»™ LLM ç”Ÿæˆç­”æ¡ˆ
```

## ğŸ’¡ å…³é”®æŠ€æœ¯ç‚¹

### 1. æ–‡æœ¬åˆ†å‰²ç­–ç•¥
- ä½¿ç”¨é€’å½’åˆ†å‰²å™¨
- å—å¤§å°: 1000 å­—ç¬¦
- é‡å : 200 å­—ç¬¦
- ä¿ç•™è¯­ä¹‰è¿è´¯æ€§

### 2. å‘é‡åŒ–æ–¹æ¡ˆ
- æ¨¡å‹: text-embedding-3-small
- ç»´åº¦: 1536
- æ”¯æŒæ‰¹é‡å¤„ç†
- ç¼“å­˜æœºåˆ¶

### 3. å‘é‡æœç´¢ä¼˜åŒ–
- ç´¢å¼•ç±»å‹: IVF_FLAT (å¯å‡çº§ä¸º HNSW)
- è·ç¦»åº¦é‡: L2 (æ¬§æ°è·ç¦»)
- ç”¨æˆ·éš”ç¦»: é€šè¿‡ userId è¿‡æ»¤
- ç›¸ä¼¼åº¦é˜ˆå€¼: å¯é…ç½®

### 4. RAG å¢å¼º
- è‡ªåŠ¨ä¸Šä¸‹æ–‡æ£€ç´¢
- åŠ¨æ€æç¤ºè¯æ„å»º
- å¤šæ–‡æ¡£èåˆ
- ç›¸ä¼¼åº¦æƒé‡

## ğŸ”§ é…ç½®å‚æ•°

### Milvus é…ç½®
```typescript
// é›†åˆå‚æ•°
collectionName: 'knowledge_vectors'
vectorDim: 1536              // OpenAI embedding ç»´åº¦
indexType: 'IVF_FLAT'        // ç´¢å¼•ç±»å‹
metricType: 'L2'             // è·ç¦»åº¦é‡
nlist: 1024                  // èšç±»æ•°é‡
```

### LangChain é…ç½®
```typescript
// æ–‡æœ¬åˆ†å‰²
chunkSize: 1000              // å—å¤§å°
chunkOverlap: 200            // é‡å å¤§å°
separators: ['\n\n', '\n', ' ', '']  // åˆ†å‰²ä¼˜å…ˆçº§
```

### LLM é…ç½®
```typescript
// OpenAI æ¨¡å‹
modelName: 'gpt-3.5-turbo'
temperature: 0.7             // åˆ›æ„åº¦
maxTokens: 1000              // æœ€å¤§è¾“å‡º
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **å‘é‡ç”Ÿæˆ**: ~100ms/æ–‡æ¡£
- **ç›¸ä¼¼åº¦æœç´¢**: ~10ms/æŸ¥è¯¢
- **æ–‡æ¡£å¤„ç†**: ~500ms/1000å­—ç¬¦
- **æ”¯æŒæ–‡æ¡£æ•°**: 100K+ (å–å†³äº Milvus é…ç½®)
- **å¹¶å‘è¿æ¥**: 100+ (å–å†³äºæœåŠ¡å™¨)

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ·»åŠ å­¦ä¹ ç¬”è®°
```bash
curl -X POST http://localhost:3001/api/knowledge-base/documents \
  -H "Content-Type: application/json" \
  -d '{
    "title": "React Hooks å­¦ä¹ ç¬”è®°",
    "content": "useState, useEffect, useContext æ˜¯æœ€å¸¸ç”¨çš„ Hooks...",
    "source": "personal-notes"
  }'
```

### ç¤ºä¾‹ 2: æŸ¥è¯¢çŸ¥è¯†åº“
```bash
curl -X POST http://localhost:3001/api/knowledge-base/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "å¦‚ä½•åœ¨ React ä¸­ç®¡ç†çŠ¶æ€ï¼Ÿ",
    "topK": 5,
    "threshold": 0.5
  }'
```

### ç¤ºä¾‹ 3: RAG æŸ¥è¯¢
```bash
curl -X POST http://localhost:3001/api/knowledge-base/rag-query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "React Hooks æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ",
    "topK": 3
  }'
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| Milvus è¿æ¥å¤±è´¥ | æ£€æŸ¥ docker-compose çŠ¶æ€ï¼Œé‡å¯æœåŠ¡ |
| OpenAI API é”™è¯¯ | éªŒè¯ API å¯†é’¥ï¼Œæ£€æŸ¥é…é¢ |
| å‘é‡ç»´åº¦ä¸åŒ¹é… | ç¡®ä¿æ¨¡å‹ä¸ Milvus é…ç½®ä¸€è‡´ |
| æŸ¥è¯¢ç»“æœä¸ç›¸å…³ | å¢åŠ  thresholdï¼Œæ£€æŸ¥æ–‡æ¡£è´¨é‡ |
| æ€§èƒ½ä¸‹é™ | ä¼˜åŒ–ç´¢å¼•å‚æ•°ï¼Œå¢åŠ æœåŠ¡å™¨èµ„æº |

## ğŸ“š å­¦ä¹ èµ„æº

- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [Milvus å®˜æ–¹æ–‡æ¡£](https://milvus.io/)
- [OpenAI Embeddings](https://platform.openai.com/docs/guides/embeddings)
- [RAG è®ºæ–‡](https://arxiv.org/abs/2005.11401)
- [NestJS æ–‡æ¡£](https://docs.nestjs.com/)

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

1. **é«˜çº§ç´¢å¼•**
   - å‡çº§åˆ° HNSW ç´¢å¼•
   - æ”¯æŒå¤šå‘é‡æ£€ç´¢
   - GPU åŠ é€Ÿ

2. **åŠŸèƒ½æ‰©å±•**
   - PDF æ–‡æ¡£æ”¯æŒ
   - ç½‘é¡µå†…å®¹çˆ¬å–
   - å®æ—¶æ–‡æ¡£æ›´æ–°

3. **æ€§èƒ½ä¼˜åŒ–**
   - å‘é‡ç¼“å­˜æœºåˆ¶
   - æ‰¹é‡å¤„ç†ä¼˜åŒ–
   - å¼‚æ­¥å¤„ç†é˜Ÿåˆ—

4. **å®‰å…¨åŠ å›º**
   - æ•°æ®åŠ å¯†å­˜å‚¨
   - è®¿é—®æ§åˆ¶
   - å®¡è®¡æ—¥å¿—

5. **ç”¨æˆ·ä½“éªŒ**
   - å‰ç«¯æœç´¢å»ºè®®
   - æŸ¥è¯¢å†å²
   - æ”¶è—å¤¹åŠŸèƒ½

## âœ… æ£€æŸ¥æ¸…å•

- [x] LangChain é›†æˆ
- [x] Milvus å‘é‡æ•°æ®åº“
- [x] OpenAI Embeddings
- [x] æ–‡æ¡£ç®¡ç† API
- [x] æŸ¥è¯¢ API
- [x] RAG åŠŸèƒ½
- [x] LLM é›†æˆ
- [x] å‰ç«¯ç»„ä»¶
- [x] å•å…ƒæµ‹è¯•
- [x] æ–‡æ¡£å’Œç¤ºä¾‹

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‚è€ƒï¼š
- `RAG_KNOWLEDGE_BASE_README.md` - è¯¦ç»†æ–‡æ¡£
- `QUICK_START_RAG.md` - å¿«é€Ÿå¯åŠ¨
- `INTEGRATION_EXAMPLES.md` - é›†æˆç¤ºä¾‹

## ğŸ“ è®¸å¯è¯

ISC

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰**

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§çº§åˆ«çš„ RAG çŸ¥è¯†åº“ç³»ç»Ÿï¼Œå·²ç»ä¸ºä½ çš„ AI é¢è¯•å®˜é¡¹ç›®åšå¥½äº†å‡†å¤‡ã€‚